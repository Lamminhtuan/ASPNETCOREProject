// insider có thể bạn sẽ  thích
setTimeout(() => {
    var productIns = document.querySelectorAll('.ins-web-smart-recommender-box-item');

    if (productIns.length > 0) {
        jsonProducts = "[";
        var dataCampId = document.querySelector(".ins-notification-content").attributes["data-camp-id"].value;
        for (var i = 0; i < productIns.length; i++) {
            var name = productIns[i].querySelector('.ins-product-name').innerText;
            var id = productIns[i].querySelector('.ins-add-to-cart-wrapper.ins-adaptive-button.ins-selectable-element.ins-element-wrap.ins-element-button').attributes["ins-product-id"].value;
            product =
                {
                    'name': name,
                    'id': id,
                    'brand': name.split(" ")[0],
                    'category': "Insider - Blog Pages",
                    'list': "Có thể bạn sẽ bạn thích - Blog Pages - " + dataCampId + " - Insider",
                    'position': i
                }
            if (i == productIns.length - 1) {
                jsonProducts += (JSON.stringify(product) + "]");
                dataLayer.push({
                    'ecommerce': {
                        'impressions': JSON.parse(jsonProducts)
                    },
                    'event': 'productImpression',
                    'Platform': Platform()
                });
                continue;
            }
            jsonProducts += (JSON.stringify(product) + ",");
        }


        // product click
        $('.ins-web-smart-recommender-box-item').on('click', function () {
            var compare = this.querySelector('.ins-product-name').innerText;

            var result;
            var arrImpressions = dataLayer.filter(elem => elem.event == "productImpression");
            for (let i = 0; i < arrImpressions.length; i++) {
                if (result != undefined) {
                    break;
                }
                result = arrImpressions[i].ecommerce.impressions.find(function (elem) {
                    return elem.name == compare && elem.list == "Có thể bạn sẽ bạn thích - Blog Pages - " + dataCampId + " - Insider";
                })
            }
            dataLayer.push({
                'event': 'ProductClick',
                'ecommerce': {
                    'click': {
                        'actionField': { 'list': result.list },
                        'products': [{
                            'name': result.name,
                            'id': result.id,
                            'price': this.querySelector('.ins-product-price').innerText.replace(/\./g, "").replace(/ ₫/g, "").replace(" ", ""),
                            'brand': result.brand,
                            'category': result.category,
                            'variant': "",
                            'position': result.position
                        }]
                    }
                },
                'Platform': Platform()
            });
            //debugger;
        });
    } 

}, 3000);